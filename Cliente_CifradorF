import socket
from Crypto.Cipher import ChaCha20

def run_chacha_client():
    HOST = '127.0.0.1'
    PORT = 65432

    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.connect((HOST, PORT))
        
        # Recibir clave y nonce del servidor
        key_nonce = s.recv(1024)
        key = key_nonce[:32]  # Primeros 32 bytes: clave
        nonce = key_nonce[32:]  # Siguientes 12 bytes: nonce
        
        # Configurar cifrador
        cipher = ChaCha20.new(key=key, nonce=nonce)
        
        # Cifrar y enviar mensaje
        mensaje = b"Hola servidor usando ChaCha20 puro!"
        cifrado = cipher.encrypt(mensaje)
        s.sendall(cifrado)
        print("Mensaje cifrado enviado correctamente")

if __name__ == "__main__":
    run_chacha_client()